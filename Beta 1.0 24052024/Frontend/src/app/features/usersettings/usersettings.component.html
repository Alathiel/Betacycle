<div class="d-flex">
  <div ngbNav #nav="ngbNav" [(activeId)]="active" class="nav-pills flex-column" orientation="vertical">
    <ng-container ngbNavItem="top">
      <button ngbNavLink>Info Utente</button>
      <ng-template ngbNavContent>
        <div class="tab-pane fade active show" id="account-general" #generalContainer>

          <div class="card-body">

            <form #updateUserForm="ngForm" (submit)="UpdateUser()">
              <div class="form-group">
                <label for="firstName">Nome </label>
                <input class="form-control "
                    matInput #name='ngModel' [(ngModel)]="user.firstName" name="name" 
                    required minlength="1" placeholder="Nome" pattern="[a-zA-Z]*">
                    <ng-container *ngIf="(name.invalid && name.dirty)">
                      <div >
                        
                      </div>
                    </ng-container>
                  </div>
                  <div class="form-group">
                    <label for="lastName">Cognome </label>
                    <input class="form-control "
                    matInput #lastName="ngModel" [(ngModel)]="user.lastName" name="lastName" 
                    required minlength="1" placeholder="Cognome">
                  </div>
                  <div class="form-group">
                    <label for="birthDate">Data di nascita </label>
                    <input type ="date" class="form-control "
                     matInput #birthDate="ngModel" [(ngModel)]="user.birthDate" name="birthDate"
                     required  placeholder="Data di Nascita">
                  </div>
                  <div class="form-group">
                    <label for="phone">Telefono</label>
                    <input class="form-control "
                    matInput #phone="ngModel" [(ngModel)]="user.phone" name="phone" 
                    required minlength="2" placeholder="Telefono" pattern="\d*">
                  </div>
              <div class="col-md-12 text-center ">
                <button type="submit" [disabled]="updateUserForm.invalid" class="btn btn-primary">Aggiorna</button>
              </div>
              <div class="col-md-12 ">
              </div>
            </form>

          </div>
        </div>
      </ng-template>
    </ng-container>

    <ng-container ngbNavItem="bottom">
      <button ngbNavLink>Credenziali</button>
      <ng-template ngbNavContent>
        <div class="card-body">

          <form #updateEmailForm="ngForm" (submit)="UpdateCredentialsEmail()">
            <div class="form-group">
              <label for="Email">Email </label>
              <input class="form-control " pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$"
              matInput #email [(ngModel)]="credential.email" name="email" required
                minlength="1" placeholder="Email">
            </div>
            <br>
            <div class="col-md-12 text-center ">
              <button type="submit" [disabled]="updateEmailForm.invalid" class="btn btn-primary">Aggiorna Email</button>
            </div>
            <div class="col-md-12 ">
            </div>
          </form>

          <div>
            <form #updatePasswordForm="ngForm" (submit)="UpdateCredentialsPassword()">
              <div class="form-group">
                <label for="Password">Password</label>
                <input type="password" class="form-control" matInput #pw="ngModel" [(ngModel)]="newPassword"
                  placeholder="Password" name="pw" required pattern="^\S{6,}$" type="password">
                <ng-container *ngIf="pw.invalid && (pw.dirty)">
                  <div *ngIf="pw.errors?.['required'] || pw.errors?.['pattern']" style="color: rgb(175, 5, 5);">
                    La password deve essere almeno di 6 caratteri
                  </div>
                </ng-container>
              </div>
              <div class="form-group">
                <label for="Password">Conferma Password</label>
                <input type="password" class="form-control" matInput #pw2="ngModel" [ngModel] placeholder="Password"
                  name="pw2" required type="password" pattern="^\S{6,}$">
                <ng-container *ngIf="pw2.dirty && (pw.value != pw2.value)">
                  <div style="color: rgb(175, 5, 5);">
                    Le password devono coincidire
                  </div>
                </ng-container>
              </div>
              <div class="col-md-12 text-center ">
                <button type="submit" [disabled]="updatePasswordForm.invalid" class="btn btn-primary">Cambia Password</button>
              </div>
            </form>
          </div>

        </div>
      </ng-template>
    </ng-container>

    <ng-container ngbNavItem="middle">
      <button ngbNavLink>Indirizzi</button>
      <ng-template ngbNavContent>

        <div class="card" style="width: 15rem; height: 9 rem; margin: 10px;" *ngFor="let a of getaddress"
          style="float:left">
          <div class="card-body">
            <h5 class="card-title">{{a.address1}}</h5>
            City: {{a.city}} <br>
            Province: {{a.province}} <br>
            Nation: {{a.nation}} <br>
            CAP: {{a.cap}}<br>
            <button (click)="GoToUpdateAddress(a)" class="btn btn-outline-primary my-2 my-sm-0">Modifica Indirizzo
            </button><br>
            <button (click)="DeleteAddress(a.addressId,a.userId)" class="btn btn-outline-danger  my-2 my-sm-0">Elimina
            </button>
          </div>
        </div>
        <hr><br>
        <div class="accordion accordion-flush" id="accordionFlushExample">
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                Accordion Item #1
              </button>
            </h2>
            <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
              <div class="accordion-body">
                <form #postAddress="ngForm" (submit)="AddAddress()">
                  <div class="form-group col-md-6">
                    <label for="Indirizzo">Indirizzo </label>
                    <input type="text" class="form-control" placeholder="Via/Viale/Corso ecc..." matInput #address1="ngModel"
                      ngModel [(ngModel)]="newAddress.address1" name="address1" required minlength="1">
                  </div>
                  <div class="form-group col-md-6">
                    <label for="Citta">Città</label>
                    <input type="text" class="form-control" placeholder="Città" matInput #city="ngModel"
                      [(ngModel)]="newAddress.city" name="city" required minlength="3" pattern="[a-zA-Z]*">
                  </div>
                  <div class="form-group col-md-6">
                    <label for="Provincia">Provincia</label>
                    <input type="text" class="form-control" placeholder="Città" matInput #province="ngModel"
                      [(ngModel)]="newAddress.province" name="province" required minlength="2" maxlength="2" 
                      pattern="[A-Z]*">
                  </div>
                  <div class="form-group col-md-6">
                    <label for="Cap">CAP</label>

                    <input type="text" class="form-control" placeholder="Città" matInput #cap="ngModel"
                      [(ngModel)]="newAddress.cap" name="cap"
                       required minlength="3" maxlength="5" pattern="[0-9]{5}">
                  </div>
                  <div class="form-group col-md-6">
                    <label for="Nazione">Nazione</label>
                    <input type="text" class="form-control" placeholder="Città" matInput #nation="ngModel"
                      [(ngModel)]="newAddress.nation" name="nation" required minlength="3" maxlength="15"
                      pattern="[a-zA-Z]*">
                  </div>
                  <div class="col-md-12 text-center ">
                    <button type="submit" [disabled]="postAddress.invalid" class="btn btn-primary">Conferma</button>
                  </div>
                  <div class="col-md-12 ">
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </ng-template>
    </ng-container>

    <ng-container ngbNavItem="payment">
      <button ngbNavLink>Metodi di pagamento</button>
      <ng-template ngbNavContent>
        <h6>Pagamenti salvati:</h6><br>
        <div class="card" style="width: 18rem; height: 9 rem;" *ngFor="let p of getPayment" style="float:left">
          <div class="card-body">
            <div class="card-body">
              Titolare: <h5 class="card-title">{{p.nameCard}} {{p.surnameCard}}</h5><br>Scadenza:
              {{p.expirationDate}} <br>
              {{p.circuitCard}} <br>

              <button (click)="DeletePayment(p.idPayment)" class="btn btn-outline-danger  my-2 my-sm-0">Elimina carta
              </button>
            </div>
          </div>
        </div>

        <div class="accordion accordion-flush" id="accordionFlushExample">
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                Aggiungi nuova carta
              </button>
            </h2>
            <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
              <div class="accordion-body">
                <form #postPayment="ngForm" (submit)="AddPayment(expirationMonth,expirationYear)">
                  <div class="form-group col-md-7">
                    <label for="Indirizzo">Numero carta </label>
                    <input type="text" class="form-control" placeholder="Numero Carta" matInput #numberCard="ngModel"
                      [(ngModel)]="newPayment.numberCard" name="numberCard" required minlength="16" maxlength="16"
                      pattern="^[0-9]{16}$">

                    <ng-container *ngIf="numberCard.invalid && numberCard.dirty">
                      <div *ngIf="numberCard.errors?.['required']" style="color: rgb(175, 5, 5);">
                        Il campo Numero Carta è obbligatorio.
                      </div>
                      <div *ngIf="numberCard.errors?.['minlength']" style="color: rgb(175, 5, 5);">
                        Il numero della carta deve essere di 16 cifre.
                      </div>
                      <div *ngIf="numberCard.errors?.['pattern']" style="color: rgb(175, 5, 5);">
                        Il numero della carta deve contenere solo cifre.
                      </div>
                    </ng-container>

                  </div>
                  <div class="form-group col-md-3">
                    <label for="Citta">Data di scadenza</label>
                    <input type="text" class="form-control" placeholder="MM" matInput #expirationMonth="ngModel"
                      name="expirationMonth" required min="1" max="12" style="float: left;" [ngModel]
                      maxlength="2" minlength="2" pattern="[0-9]{2}"> -
                    <input type="text" class="form-control" placeholder="AA" matInput #expirationYear="ngModel"
                      name="expirationYear" required min="24" max="99" [ngModel] maxlength="2" minlength="2"
                      pattern="[0-9]{2}">
                    <ng-container *ngIf="((expirationMonth.invalid && expirationMonth.dirty) ||
                     (expirationYear.invalid && expirationYear.dirty)) ||
                      expirationMonth.errors?.['pattern'] || expirationYear.errors?.['pattern']">
                      <div  *ngIf="expirationMonth.errors?.['minlength'] || expirationMonth.errors?.['required'] || 
                      expirationYear.errors?.['minlength']" style="color: rgb(175, 5, 5);">
                        Mese e anno devono essere a 2 cifre e contenere solo cifre.
                      </div>

                    </ng-container>

                  </div>

                  <div class="form-group col-md-6">
                    <label for="Provincia">CVV</label>
                    <input type="text" class="form-control" placeholder="CVV" pattern="^[0-9]{3}$" matInput
                           #cVV="ngModel" [(ngModel)]="newPayment.cVV" name="cVV" required minlength="3"
                           maxlength="3">
                    <ng-container *ngIf="cVV.invalid && (cVV.dirty)">
                      <div *ngIf="cVV.errors?.['minlength'] || cVV.errors?.['maxlength'] || cVV.errors?.['required'] || cVV.errors?.['pattern']"
                           style="color: rgb(175, 5, 5);">
                        Il CVV deve essere di 3 numeri.
                      </div>
                    </ng-container>
                  </div>
                  

                  <div class="form-group col-md-6">
                    <label for="Cap">Nome Proprietario carta</label>
                    <input type="text" class="form-control" placeholder="nameCard" matInput #nameCard="ngModel"
                           [(ngModel)]="newPayment.nameCard" name="nameCard" required minlength="3" maxlength="20"
                           pattern="[A-Za-z ]*">
                    <ng-container *ngIf="(nameCard.invalid && nameCard.dirty)">
                      <div *ngIf="nameCard.errors?.['minlength'] || nameCard.errors?.['maxlength'] || nameCard.errors?.['required'] || nameCard.errors?.['pattern']"
                           style="color: rgb(175, 5, 5);">
                        Il nome deve contenere solo lettere e avere una lunghezza minima di 3 e massima di 20 caratteri.
                      </div>
                    </ng-container>
                  </div>
                  
                  <div class="form-group col-md-6">
                    <label for="Cap">Cognome Proprietario carta</label>
                    <input type="text" class="form-control" placeholder="surnameCard" matInput #surnameCard="ngModel"
                           [(ngModel)]="newPayment.surnameCard" name="surnameCard" required minlength="3" maxlength="20"
                           pattern="[A-Za-z ]*">
                    <ng-container *ngIf="(surnameCard.invalid && surnameCard.dirty)">
                      <div *ngIf="surnameCard.errors?.['minlength'] || surnameCard.errors?.['maxlength'] || surnameCard.errors?.['required'] || surnameCard.errors?.['pattern']"
                           style="color: rgb(175, 5, 5);">
                        Il cognome deve contenere solo lettere e avere una lunghezza minima di 3 e massima di 20 caratteri.
                      </div>
                    </ng-container>
                  </div>


                  <div class="col-md-12 text-center ">
                    <button type="submit" [disabled]="postPayment.invalid" class="btn btn-primary">Conferma</button>
                  </div>
                  <pre>

                  </pre>
                  <div class="col-md-12 ">
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </ng-template>
    </ng-container>
  </div>
  <div [ngbNavOutlet]="nav" class="ms-4"></div>
</div>